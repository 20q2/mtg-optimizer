<mat-spinner class="app-loading-spinner" *ngIf="appIsLoading"><img src="../assets/logo-transparent.png" height="32px"/></mat-spinner>
<div class="page-container flex-column">
  <div class="background"></div>
  <!-- Navbar -->
  <div class="flex-row flex-align-start navbar">
    <img src="../assets/logo-transparent.png" height="36px" />
    <div class="title white">MTG: SpellChroma - Card search simplified</div>
    <a>Decks</a>
    <a>Explore Cards</a>
  </div>
  
  <!-- top card preview row -->
  <div class="flex-row m16">
    <div class="flex-column w25">
      <textarea [(ngModel)]="deckList" placeholder="Enter your decklist"></textarea>
      <button class="hover-darken parse-button" (click)="parseDeckList()">Parse Decklist</button>
    </div>
    
    <div *ngIf="previewCard" class="flex-row flex-align-end preview-container">
      <!-- Preview card image -->
      <div class="flex-column">
        <img class="preview-card card" *ngIf="previewCard.imageUrl" [src]="previewCard.imageUrl" />
      </div>
      <div class="flex-column preview-description">
        <button class="close-button" (click)="clearPreviewCard()"><mat-icon>close</mat-icon></button>

        <h2>{{previewCard.name}}</h2>
        <h3>{{previewCard.type_line}}</h3>
        <h3>{{previewCard.oracle_text}}</h3>

        <!-- Tags -->
        <div class="flex-row header">
          Tags
        </div>
        <div class="flex-row">
          <ng-container *ngFor="let tag of compressAllCardTags(previewCardTagList); let i=index" >
            <div class="tag" [ngStyle]="{'animation-delay': i * 10 + 'ms'}"  (click)="onTagClick(tag)" [ngClass]="{'active': selectedTags.includes(tag), 'unhelpful': onIgnoreList(tag)}">
              {{tag}}
            </div>
           
           
          </ng-container>
        </div>

      </div>
    </div>
  </div>
  <app-color-identity-picker #colorPicker *ngIf="cards.length > 0" (reloadRecommendedCards)="loadRecommendedCardsByTag()"></app-color-identity-picker>
  <app-mana-curve #manaCurve></app-mana-curve>
  <!-- Deck stats -->
  <div class="deck-stats flex-row">
    <div class="title-row">Deck Stats</div>
    <div>

    </div>

    <div class="title-row">Recommended Stats</div>
  </div>

  <!-- Related cards by tag -->
  <div *ngIf="cardsToDisplay.length > 0 || activeFilters.length > 0">
    <ng-container *ngIf="relatedCardsByTag.length > 0">
      <div class="previewCardListToggle hover-darken title flex-row flex-align-center" (click)="displayRelatedCards = !displayRelatedCards">
        Related Cards By Tag:
        <span class="search-tag accent hover-darken" *ngFor="let selectedTag of selectedTags" (click)="onTagClick(selectedTag);$event.stopPropagation()">
          {{ selectedTag }}
        </span>
        <div *ngIf="lastSearchedColors.length > 0">
          -- Limited to colors: {{lastSearchedColors}} <mat-icon>{{displayRelatedCards ? 'arrow_drop_down' : 'arrow_drop_up'}}</mat-icon>
        </div> 
      </div>
      <div class="sort-row flex-row" *ngIf="displayRelatedCards">
        <div class="white">{{relatedCardsByTag.length}}{{ hasMoreRelatedCards ? '+' : '' }} cards </div>
        <button mat-raised-button color="primary" (click)="sortRelatedBy($event)" value="name">Name</button>
        <button mat-raised-button color="accent" (click)="sortRelatedBy($event)" value="cmc">CMC</button>
        <button mat-raised-button (click)="sortRelatedBy($event)" value="color">Color</button>
        <button mat-raised-button (click)="sortRelatedBy($event)" value="type">Type</button>
        <div>Sorted by: {{ lastSortMode }}</div>
      </div>

      <app-card-grid *ngIf="displayRelatedCards" [cardsToDisplay]="relatedCardsByTag" (previewCardEmit)="previewCard = $event; onCardClick()"></app-card-grid>
      <div *ngIf="moreRelatedCardsLink !== ''">
        <button mat-stroked-button color="primary" (click)="loadNextRecommendedPage()">Load More</button>
      </div>
    </ng-container>

    <!-- Deck Card List -->
    <div class="previewCardListToggle hover-darken flex-align-center flex-row" (click)="displayCardList = !displayCardList">
      <div class="title">Card List ({{ cards.length }}) <mat-icon>{{displayCardList ? 'arrow_drop_down' : 'arrow_drop_up'}}</mat-icon></div>
    </div>
    <div *ngIf="topTags.length > 0 && displayCardList" class="flex-column top-tags-container">
      <div class="title white">Top Deck Tags (10)</div>
      <div class="flex-row gap-10">
        <div
          *ngFor="let tag of topTags"
          [ngStyle]="{'font-size': tag.instances + 10 + 'px'}"
          class="tag"
          (click)="filterDeckByTag(tag.key)"
          [ngClass]="{'active': activeFilters.includes(tag.key)}">
          {{ tag.key }} | {{ tag.instances }}
        </div>
      </div>
    </div>

    <app-card-grid *ngIf="displayCardList" [cardsToDisplay]="cardsToDisplay" (previewCardEmit)="previewCard = $event; onCardClick()"></app-card-grid>
  </div>
  
</div>